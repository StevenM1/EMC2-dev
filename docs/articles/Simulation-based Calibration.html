<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulation-based Calibration • EMC2</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation-based Calibration">
<meta name="description" content="A guide to SBC in EMC2">
<meta property="og:description" content="A guide to SBC in EMC2">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EMC2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Simulation-based%20Calibration.html">Simulation-based Calibration</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ampl-psych/EMC2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulation-based Calibration</h1>
                        <h4 data-toc-skip class="author">Niek
Stevenson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ampl-psych/EMC2/blob/HEAD/vignettes/Simulation-based%20Calibration.Rmd" class="external-link"><code>vignettes/Simulation-based Calibration.Rmd</code></a></small>
      <div class="d-none name"><code>Simulation-based Calibration.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Simulation-based calibration(SBC) is a technique used to validate and
calibrate Bayesian estimation methods and models. It checks whether a
model correctly accounts for uncertainty and whether the posterior
distributions it produces are consistent with the true data-generating
process. First we outline how to perform SBC in theory, after which we
describe our experiences with SBC in <em>EMC2</em>, which will also
illustrate how to perform SBC for your own model.</p>
</div>
<div class="section level2">
<h2 id="how-to-sbc">How to SBC<a class="anchor" aria-label="anchor" href="#how-to-sbc"></a>
</h2>
<p>Here we briefly outline the steps to performing SBC, for more detail
we refer the reader to X</p>
<div class="section level3">
<h3 id="specify-the-probabilistic-model">1. Specify the Probabilistic Model<a class="anchor" aria-label="anchor" href="#specify-the-probabilistic-model"></a>
</h3>
<ul>
<li>Define the Bayesian model you’re working with. This includes
specifying the prior distribution for the parameters and the likelihood
function that connects the data to the parameters.</li>
<li>For example, suppose you have a model with a set of parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and observed data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>∼</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y \sim p(y|\alpha)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>∼</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha \sim p(\alpha)</annotation></semantics></math>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="simulate-parameters-and-data">2. Simulate Parameters and Data<a class="anchor" aria-label="anchor" href="#simulate-parameters-and-data"></a>
</h3>
<ul>
<li>
<strong>Sample Parameters</strong>: Draw a large number of sets of
parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\alpha^{(i)}</annotation></semantics></math>
from the prior distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\alpha)</annotation></semantics></math>.</li>
<li>
<strong>Simulate Data</strong>: For each set of set parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\alpha^{(i)}</annotation></semantics></math>,
simulate a dataset
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">y^{(i)}</annotation></semantics></math>
from the likelihood
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><msup><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(y|\alpha^{(i)})</annotation></semantics></math>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="compute-posterior-distributions">3. Compute Posterior Distributions<a class="anchor" aria-label="anchor" href="#compute-posterior-distributions"></a>
</h3>
<ul>
<li>For each simulated dataset
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">y^{(i)}</annotation></semantics></math>,
compute the posterior distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="false" form="prefix">|</mo><msup><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\alpha | y^{(i)})</annotation></semantics></math>
using your Bayesian model.</li>
</ul>
</div>
<div class="section level3">
<h3 id="evaluate-the-rank-statistics">4. Evaluate the Rank Statistics<a class="anchor" aria-label="anchor" href="#evaluate-the-rank-statistics"></a>
</h3>
<ul>
<li>For each simulated dataset, determine where the set of true
parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\alpha^{(i)}</annotation></semantics></math>
ranks in the posterior samples of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.
The rank is essentially the number of posterior samples that are less
than the true
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\alpha^{(i)}</annotation></semantics></math>.</li>
<li>Normalize the ranks to lie between 0 and 1. This is your
<strong>rank statistic</strong>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="check-uniformity">5. Check Uniformity<a class="anchor" aria-label="anchor" href="#check-uniformity"></a>
</h3>
<ul>
<li>Aggregate the rank statistics across all simulated datasets. If your
model is well-calibrated, the ranks should be uniformly distributed
because each posterior should correctly reflect the uncertainty about
the parameter.</li>
<li>Plot a histogram of the rank statistics. If the model is correctly
calibrated, this histogram should be roughly uniform across all bins.
Throughout we include dotted lines of the 2.5%, 50% and 97.5% quantile
of where randomly generated uniform data is expected to fall in the
histogram.</li>
</ul>
</div>
<div class="section level3">
<h3 id="interpret-the-results">6. Interpret the Results<a class="anchor" aria-label="anchor" href="#interpret-the-results"></a>
</h3>
<ul>
<li>
<strong>Uniform Distribution</strong>: If the rank histogram is
uniform, it suggests that the posterior distributions are
well-calibrated and the model properly reflects the uncertainty in the
parameters.</li>
<li>
<strong>Non-Uniform Distribution</strong>: If the rank histogram is
not uniform (e.g., it shows peaks or troughs), it suggests that the
model might be mis-specified. For example, if the histogram is skewed,
it might indicate that the model is underestimating or overestimating
uncertainty.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="non-hierarchical-sbc-in-emc2">Non-hierarchical SBC in EMC2<a class="anchor" aria-label="anchor" href="#non-hierarchical-sbc-in-emc2"></a>
</h2>
<p><em>EMC2</em> allows for both hierarchical and non-hierarchical
estimation. Given the desirable statistical and estimation properties of
hierarchical models, we normally recommend to use hierarchical models.
However, given that estimating hundreds of models is quite time
consuming and practically unfeasible without a computational server, we
recommend running SBC on non-hierarchical models for typical
applications. Here we use the LBA and DDM to illustrate non-hierarchical
SBC.</p>
<div class="section level3">
<h3 id="lba">LBA<a class="anchor" aria-label="anchor" href="#lba"></a>
</h3>
<p>First we specify a design and a prior for the model. EMC2 assumes
normal priors on the parameters. Thus, some parameters are transformed
to better match the normal prior and to satisfy the assumption of the
normal distribution to have full support on the real line. To check the
parameter transformations we use <code><a href="../reference/LBA.html">?LBA</a></code> .</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">EMC2</span><span class="op">)</span></span>
<span><span class="op">?</span><span class="va">LBA</span></span>
<span><span class="va">matchfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="va">d</span><span class="op">$</span><span class="va">S</span> <span class="op">==</span> <span class="va">d</span><span class="op">$</span><span class="va">lR</span></span>
<span></span>
<span><span class="va">design_LBA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span>factors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>subjects<span class="op">=</span><span class="fl">1</span>,S<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     Rlevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span>,</span>
<span>                     matchfun <span class="op">=</span> <span class="va">matchfun</span>,</span>
<span>                     formula <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">v</span><span class="op">~</span><span class="va">lM</span>,<span class="va">B</span><span class="op">~</span><span class="fl">1</span>, <span class="va">t0</span><span class="op">~</span><span class="fl">1</span>, <span class="va">sv</span><span class="op">~</span><span class="fl">1</span>, <span class="va">A</span><span class="op">~</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                     constants<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>sv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     model <span class="op">=</span> <span class="va">LBA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prior_in</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="va">design_LBA</span>, type <span class="op">=</span> <span class="st">"single"</span>,</span>
<span>                  pmean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.3</span>, <span class="fl">.7</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  psd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.05</span>, <span class="fl">.05</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we plot the prior, with <code>map = TRUE</code> (the default) to
see how the implied prior on the transformed parameters.</p>
<p>Next we can simply run <code>run_SBC</code> with our specified design
and prior. We can use ?run_SBC to see the description of the function
arguments</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SBC_single.html">SBC_single</a></span><span class="op">(</span><span class="va">design_LBA</span>, <span class="va">prior_in</span>, replicates <span class="op">=</span> <span class="fl">500</span>, trials <span class="op">=</span> <span class="fl">100</span>, plot_data <span class="op">=</span> <span class="cn">F</span>,</span>
<span>                  iter <span class="op">=</span> <span class="fl">1000</span>, n_post <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Niek Stevenson, Michelle Donzallaz, Andrew Heathcote.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
